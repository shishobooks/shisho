# Shisho Configuration File
#
# Copy this file to /config/shisho.yaml (or set CONFIG_FILE env var to point elsewhere)
#
# All settings can also be configured via environment variables.
# Environment variables use uppercase with underscores (e.g., DATABASE_FILE_PATH).
# Environment variables take precedence over config file values.

# =============================================================================
# DATABASE SETTINGS
# =============================================================================

# REQUIRED: Path to the SQLite database file
# Env: DATABASE_FILE_PATH
database_file_path: /data/shisho.db

# Enable SQL query logging (useful for debugging)
# Env: DATABASE_DEBUG
# Default: false
database_debug: false

# Number of connection retry attempts on startup
# Env: DATABASE_CONNECT_RETRY_COUNT
# Default: 5
database_connect_retry_count: 5

# Delay between connection retry attempts
# Env: DATABASE_CONNECT_RETRY_DELAY
# Default: 2s
database_connect_retry_delay: 2s

# SQLite busy timeout - how long to wait when the database is locked
# Env: DATABASE_BUSY_TIMEOUT
# Default: 5s
database_busy_timeout: 5s

# Maximum number of retries for database operations on busy/locked errors
# Env: DATABASE_MAX_RETRIES
# Default: 5
database_max_retries: 5

# =============================================================================
# SERVER SETTINGS
# =============================================================================

# Host address to bind the server to
# Env: SERVER_HOST
# Default: 0.0.0.0
server_host: 0.0.0.0

# Port to listen on
# Env: SERVER_PORT
# Default: 3689
server_port: 3689

# =============================================================================
# APPLICATION SETTINGS
# =============================================================================

# How often to scan libraries for new content (in minutes)
# Env: SYNC_INTERVAL_MINUTES
# Default: 60
sync_interval_minutes: 60

# Number of background worker processes
# Env: WORKER_PROCESSES
# Default: 2
worker_processes: 2

# How many days to retain completed/failed jobs (older jobs are deleted)
# Set to 0 to disable retention cleanup
# Env: JOB_RETENTION_DAYS
# Default: 30
job_retention_days: 30

# =============================================================================
# DOWNLOAD CACHE SETTINGS
# =============================================================================

# Directory for caching generated download files
# When users download files, modified versions with embedded metadata are generated
# and cached here to avoid regenerating on each download.
# Env: DOWNLOAD_CACHE_DIR
# Default: /config/cache/downloads
download_cache_dir: /config/cache/downloads

# Maximum size of the download cache in gigabytes
# When the cache exceeds this size, older files are automatically removed (LRU).
# Env: DOWNLOAD_CACHE_MAX_SIZE_GB
# Default: 5
download_cache_max_size_gb: 5

# =============================================================================
# SUPPLEMENT DISCOVERY SETTINGS
# =============================================================================

# Patterns to exclude from supplement discovery (glob patterns)
# These files will not be picked up as supplements even if they're in book directories
# Env: SUPPLEMENT_EXCLUDE_PATTERNS (comma-separated)
# Default: [".*", ".DS_Store", "Thumbs.db", "desktop.ini"]
supplement_exclude_patterns:
  - ".*" # hidden files (dotfiles)
  - ".DS_Store"
  - "Thumbs.db"
  - "desktop.ini"

# =============================================================================
# AUTHENTICATION SETTINGS
# =============================================================================

# REQUIRED: Secret key for signing JWT tokens
# Use a long, random string (at least 32 characters recommended)
# Generate one with: openssl rand -base64 32
# Env: JWT_SECRET
jwt_secret: your-secret-key-here-change-me
